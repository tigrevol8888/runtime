<!DOCTYPE html>
<meta charset="utf-8">
<div id="foo"></div>
<div id="bar"></div>
<script src="/build/d3-express.js"></script>
<script>

var module = d3.runtime().module();

var foo = module.variable(document.querySelector("#foo")).define("foo", [], () => {
  return Math.random();
});

var bar = module.variable(document.querySelector("#bar")).define("bar", ["foo"], (foo) => {
  return new Promise(resolve => {
    setTimeout(() => resolve(foo), 250);
  });
});

setTimeout(() => {
  foo.define("foo", [], () => {
    return 42;
  });
}, 750);

</script>
